<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moltbot Dashboard</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            padding: 16px;
            padding-bottom: 80px; /* Extra space for bottom navigation */
        }
        
        .header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .tab-container {
            display: none;
        }
        
        .tab-container.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .weather-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .weather-tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #edf2f7;
            color: #4a5568;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .weather-tab-btn.active {
            background: #4299e1;
            color: white;
        }
        
        .weather-content {
            display: none;
        }
        
        .weather-content.active {
            display: block;
        }
        
        .current-weather {
            text-align: center;
            padding: 20px 0;
        }
        
        .temperature {
            font-size: 48px;
            font-weight: 300;
            margin-bottom: 8px;
            color: #2d3748;
        }
        
        .weather-condition {
            font-size: 20px;
            color: #4a5568;
            margin-bottom: 16px;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        .weather-detail {
            text-align: center;
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
        }
        
        .detail-label {
            font-size: 12px;
            color: #718096;
            margin-bottom: 4px;
        }
        
        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .forecast-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .forecast-item:last-child {
            border-bottom: none;
        }
        
        .forecast-day {
            font-weight: 600;
            color: #2d3748;
        }
        
        .forecast-temp {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .forecast-high {
            font-weight: 600;
            color: #2d3748;
        }
        
        .forecast-low {
            color: #718096;
        }
        
        .task-form {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .task-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .task-input:focus {
            outline: none;
            border-color: #4299e1;
        }
        
        .priority-select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            font-size: 16px;
        }
        
        .add-task-btn {
            padding: 12px 20px;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .task-text {
            flex: 1;
            font-size: 16px;
        }
        
        .task-priority {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 12px;
        }
        
        .priority-high {
            background: #fed7d7;
            color: #c53030;
        }
        
        .priority-medium {
            background: #fef3c7;
            color: #d69e2e;
        }
        
        .priority-low {
            background: #d4edda;
            color: #155724;
        }
        
        .task-actions {
            display: flex;
            gap: 8px;
        }
        
        .task-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .complete-btn {
            background: #48bb78;
            color: white;
        }
        
        .delete-btn {
            background: #f56565;
            color: white;
        }
        
        .service-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .service-status:last-child {
            border-bottom: none;
        }
        
        .service-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-active {
            background: #48bb78;
        }
        
        .status-inactive {
            background: #f56565;
        }
        
        .status-warning {
            background: #ed8936;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            background: white;
            border-top: 1px solid #e2e8f0;
            padding: 12px 0;
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px 0;
            cursor: pointer;
            border-radius: 8px;
            margin: 0 8px;
            transition: all 0.2s;
        }
        
        .nav-item.active {
            background: #4299e1;
            color: white;
        }
        
        .nav-item:hover {
            background: #edf2f7;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .dashboard-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .dashboard-number {
            font-size: 24px;
            font-weight: 600;
            color: #4299e1;
            margin-bottom: 4px;
        }
        
        .dashboard-label {
            font-size: 14px;
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Moltbot Dashboard</h1>
        <p>Your personal productivity hub</p>
    </div>

    <!-- Dashboard Tab -->
    <div id="dashboard-tab" class="tab-container active">
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="dashboard-number" id="tasks-count">0</div>
                <div class="dashboard-label">Tasks</div>
            </div>
            <div class="dashboard-card">
                <div class="dashboard-number" id="weather-temp">--¬∞C</div>
                <div class="dashboard-label">Current Temp</div>
            </div>
            <div class="dashboard-card">
                <div class="dashboard-number" id="services-count">--</div>
                <div class="dashboard-label">Services</div>
            </div>
            <div class="dashboard-card">
                <div class="dashboard-number" id="notifications-count">0</div>
                <div class="dashboard-label">Notifications</div>
            </div>
        </div>

        <div class="card">
            <h3 class="card-title">üìÖ Today's Tasks</h3>
            <div id="dashboard-tasks">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <p>No tasks for today</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 class="card-title">üîî Notifications</h3>
            <div id="dashboard-notifications">
                <div class="empty-state">
                    <div class="empty-state-icon">üîî</div>
                    <p>No new notifications</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Weather Tab -->
    <div id="weather-tab" class="tab-container">
        <div class="card">
            <h3 class="card-title">üå§Ô∏è Weather in Estoril, Portugal</h3>
            <div class="weather-tabs">
                <button class="weather-tab-btn active" onclick="switchWeatherTab('current')">Current</button>
                <button class="weather-tab-btn" onclick="switchWeatherTab('forecast')">Forecast</button>
            </div>
            
            <div id="current-weather" class="weather-content active">
                <div class="current-weather">
                    <div class="temperature" id="current-temp">--¬∞C</div>
                    <div class="weather-condition" id="current-condition">Loading...</div>
                    <div class="weather-details">
                        <div class="weather-detail">
                            <div class="detail-label">Feels Like</div>
                            <div class="detail-value" id="feels-like">--¬∞C</div>
                        </div>
                        <div class="weather-detail">
                            <div class="detail-label">Humidity</div>
                            <div class="detail-value" id="humidity">--%</div>
                        </div>
                        <div class="weather-detail">
                            <div class="detail-label">Wind</div>
                            <div class="detail-value" id="wind-speed">-- km/h</div>
                        </div>
                        <div class="weather-detail">
                            <div class="detail-label">Location</div>
                            <div class="detail-value" id="location">Estoril</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="forecast-weather" class="weather-content">
                <div id="forecast-list">
                    <!-- Forecast items will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks Tab -->
    <div id="tasks-tab" class="tab-container">
        <div class="card">
            <h3 class="card-title">üìã Task Manager</h3>
            <div class="task-form">
                <input type="text" id="task-input" class="task-input" placeholder="Add a new task..." onkeypress="handleTaskKeyPress(event)">
                <select id="priority-select" class="priority-select">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                </select>
                <button class="add-task-btn" onclick="addTask()">Add</button>
            </div>
            <div id="tasks-list">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <p>No tasks yet. Add your first task!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- System Status Tab -->
    <div id="status-tab" class="tab-container">
        <div class="card">
            <h3 class="card-title">üñ•Ô∏è System Status</h3>
            <div id="services-list">
                <!-- Services will be populated here -->
            </div>
        </div>
        <div class="card">
            <h3 class="card-title">‚öôÔ∏è Cron Jobs</h3>
            <div id="cron-jobs-list">
                <!-- Cron jobs will be populated here -->
            </div>
        </div>
        <div class="card">
            <h3 class="card-title">ü§ñ Running Agents</h3>
            <div id="agents-list">
                <!-- Agents will be populated here -->
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('dashboard')" data-tab="dashboard">
            <div class="nav-icon">üè†</div>
            <div>Dashboard</div>
        </div>
        <div class="nav-item" onclick="switchTab('weather')" data-tab="weather">
            <div class="nav-icon">üå§Ô∏è</div>
            <div>Weather</div>
        </div>
        <div class="nav-item" onclick="switchTab('tasks')" data-tab="tasks">
            <div class="nav-icon">üìã</div>
            <div>Tasks</div>
        </div>
        <div class="nav-item" onclick="switchTab('status')" data-tab="status">
            <div class="nav-icon">üñ•Ô∏è</div>
            <div>Status</div>
        </div>
    </div>

    <script>
        // Global state
        let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
        let weatherData = {};
        let forecastData = [];

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadTasks();
            loadWeather();
            loadSystemStatus();
            updateDashboard();
        });

        function initializeApp() {
            // Initialize Telegram Web App if available
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
            }
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-container').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to selected nav item
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        function switchWeatherTab(tabName) {
            // Remove active class from all weather tab buttons
            document.querySelectorAll('.weather-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Hide all weather content sections
            document.querySelectorAll('.weather-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Add active class to selected button
            event.target.classList.add('active');
            
            // Show selected content
            document.getElementById(`${tabName}-weather`).classList.add('active');
        }

        function addTask() {
            const input = document.getElementById('task-input');
            const prioritySelect = document.getElementById('priority-select');
            
            const text = input.value.trim();
            const priority = prioritySelect.value;
            
            if (!text) return;
            
            const task = {
                id: Date.now(),
                text: text,
                priority: priority,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(task);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            input.value = '';
            loadTasks();
            updateDashboard();
        }

        function handleTaskKeyPress(event) {
            if (event.key === 'Enter') {
                addTask();
            }
        }

        function toggleTaskCompletion(id) {
            tasks = tasks.map(task => {
                if (task.id === id) {
                    return {...task, completed: !task.completed};
                }
                return task;
            });
            localStorage.setItem('tasks', JSON.stringify(tasks));
            loadTasks();
            updateDashboard();
        }

        function deleteTask(id) {
            tasks = tasks.filter(task => task.id !== id);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            loadTasks();
            updateDashboard();
        }

        function loadTasks() {
            const tasksList = document.getElementById('tasks-list');
            const dashboardTasks = document.getElementById('dashboard-tasks');
            
            if (tasks.length === 0) {
                tasksList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>No tasks yet. Add your first task!</p>
                    </div>
                `;
                dashboardTasks.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>No tasks for today</p>
                    </div>
                `;
                return;
            }
            
            // Update tasks list
            tasksList.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <div class="task-text" style="text-decoration: ${task.completed ? 'line-through' : 'none'};">
                        <span class="task-priority priority-${task.priority}">${task.priority.charAt(0).toUpperCase()}</span>
                        ${task.text}
                    </div>
                    <div class="task-actions">
                        <button class="task-btn ${task.completed ? 'complete-btn' : 'complete-btn'}" 
                                onclick="toggleTaskCompletion(${task.id})">
                            ${task.completed ? 'Undo' : 'Done'}
                        </button>
                        <button class="task-btn delete-btn" onclick="deleteTask(${task.id})">X</button>
                    </div>
                </div>
            `).join('');
            
            // Update dashboard tasks
            const incompleteTasks = tasks.filter(t => !t.completed);
            dashboardTasks.innerHTML = incompleteTasks.slice(0, 3).map(task => `
                <div class="task-item">
                    <div class="task-text" style="text-decoration: ${task.completed ? 'line-through' : 'none'};">
                        <span class="task-priority priority-${task.priority}">${task.priority.charAt(0).toUpperCase()}</span>
                        ${task.text}
                    </div>
                </div>
            `).join('');
            
            if (incompleteTasks.length > 3) {
                dashboardTasks.innerHTML += `<div class="task-item"><div class="task-text">... and ${incompleteTasks.length - 3} more</div></div>`;
            }
        }

        async function loadWeather() {
            try {
                // Using WeatherAPI.com with your API key
                const apiKey = 'df3b640d19554b709fa141721262801';
                const location = 'Estoril';
                
                // Fetch current weather
                const currentResponse = await fetch(`https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${encodeURIComponent(location)}&aqi=no`);
                const currentData = await currentResponse.json();
                
                // Fetch forecast
                const forecastResponse = await fetch(`https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${encodeURIComponent(location)}&days=3&aqi=no&alerts=no`);
                const forecastDataResult = await forecastResponse.json();
                
                weatherData = currentData;
                forecastData = forecastDataResult.forecast.forecastday;
                
                updateWeatherDisplay();
            } catch (error) {
                console.error('Error loading weather:', error);
                
                // Show error in UI
                document.getElementById('current-temp').textContent = 'Error';
                document.getElementById('current-condition').textContent = 'Could not load weather';
                document.getElementById('feels-like').textContent = '--¬∞C';
                document.getElementById('humidity').textContent = '--%';
                document.getElementById('wind-speed').textContent = '-- km/h';
                
                // Show error in forecast
                document.getElementById('forecast-list').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚õàÔ∏è</div>
                        <p>Could not load forecast</p>
                    </div>
                `;
            }
        }

        function updateWeatherDisplay() {
            if (weatherData && weatherData.current) {
                document.getElementById('current-temp').textContent = `${Math.round(weatherData.current.temp_c)}¬∞C`;
                document.getElementById('current-condition').textContent = weatherData.current.condition.text;
                document.getElementById('feels-like').textContent = `${Math.round(weatherData.current.feelslike_c)}¬∞C`;
                document.getElementById('humidity').textContent = `${weatherData.current.humidity}%`;
                document.getElementById('wind-speed').textContent = `${Math.round(weatherData.current.wind_kph)} km/h`;
                document.getElementById('location').textContent = `${weatherData.location.name}, ${weatherData.location.country}`;
                
                // Update dashboard
                document.getElementById('weather-temp').textContent = `${Math.round(weatherData.current.temp_c)}¬∞C`;
            }
            
            if (forecastData && forecastData.length > 0) {
                const forecastHtml = forecastData.map((day, index) => {
                    const dayNames = ['Today', 'Tomorrow', 'In 2 days'];
                    const dayName = index < 3 ? dayNames[index] : day.date;
                    
                    return `
                        <div class="forecast-item">
                            <div class="forecast-day">${dayName}</div>
                            <div class="forecast-temp">
                                <span class="forecast-high">${Math.round(day.day.maxtemp_c)}¬∞</span>
                                <span class="forecast-low">${Math.round(day.day.mintemp_c)}¬∞</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                document.getElementById('forecast-list').innerHTML = forecastHtml;
            }
        }

        function loadSystemStatus() {
            // Mock system status data
            const services = [
                { name: 'Moltbot Gateway', status: 'active', uptime: '99.9%' },
                { name: 'Web Server', status: 'active', uptime: '99.8%' },
                { name: 'Database', status: 'active', uptime: '99.9%' },
                { name: 'File Storage', status: 'warning', uptime: '98.5%' },
                { name: 'Backup Service', status: 'active', uptime: '99.7%' }
            ];
            
            const cronJobs = [
                { name: 'Daily Backup', schedule: '0 2 * * *', lastRun: '2026-01-28 02:00', status: 'success' },
                { name: 'Health Check', schedule: '*/5 * * * *', lastRun: '2026-01-28 14:15', status: 'success' },
                { name: 'Log Cleanup', schedule: '0 3 * * 0', lastRun: '2026-01-25 03:00', status: 'success' },
                { name: 'Package Tracker', schedule: '0 */2 * * *', lastRun: '2026-01-28 14:00', status: 'success' }
            ];
            
            const agents = [
                { name: 'Package Tracker', status: 'running', lastActive: '2026-01-28 14:15' },
                { name: 'Weather Monitor', status: 'running', lastActive: '2026-01-28 14:10' },
                { name: 'File Sync', status: 'stopped', lastActive: '2026-01-28 12:00' },
                { name: 'Notification Service', status: 'running', lastActive: '2026-01-28 14:15' }
            ];
            
            // Update services list
            document.getElementById('services-list').innerHTML = services.map(service => `
                <div class="service-status">
                    <div class="service-info">
                        <div class="status-indicator status-${service.status}"></div>
                        <span>${service.name}</span>
                    </div>
                    <div>${service.uptime}</div>
                </div>
            `).join('');
            
            // Update cron jobs list
            document.getElementById('cron-jobs-list').innerHTML = cronJobs.map(job => `
                <div class="service-status">
                    <div class="service-info">
                        <div class="status-indicator status-${job.status === 'success' ? 'active' : 'warning'}"></div>
                        <span>${job.name}</span>
                    </div>
                    <div>${job.schedule}</div>
                </div>
            `).join('');
            
            // Update agents list
            document.getElementById('agents-list').innerHTML = agents.map(agent => `
                <div class="service-status">
                    <div class="service-info">
                        <div class="status-indicator status-${agent.status === 'running' ? 'active' : 'inactive'}"></div>
                        <span>${agent.name}</span>
                    </div>
                    <div>${agent.lastActive}</div>
                </div>
            `).join('');
            
            // Update dashboard
            document.getElementById('services-count').textContent = services.length;
        }

        function updateDashboard() {
            // Update dashboard stats
            document.getElementById('tasks-count').textContent = tasks.length;
            document.getElementById('notifications-count').textContent = 3; // Mock value
            
            // Update task list preview
            const incompleteTasks = tasks.filter(t => !t.completed);
            document.getElementById('tasks-count').textContent = incompleteTasks.length;
        }

        // Auto-refresh weather every 30 minutes
        setInterval(loadWeather, 30 * 60 * 1000);
    </script>
</body>
</html>